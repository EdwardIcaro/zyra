generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id            Int         @id @default(autoincrement())
  username      String      @unique @db.VarChar(50)
  password_hash String?     @db.VarChar(255)
  created_at    DateTime?   @default(now()) @db.Timestamp(6)
  characters    Character[]

  @@map("accounts")
}

model Character {
  id               Int               @id(map: "players_pkey") @default(autoincrement())
  sessionId        String            @unique(map: "players_session_id_key") @map("session_id") @db.VarChar(255)
  username         String?           @db.VarChar(50)
  classType        String            @map("class_type") @db.VarChar(50)
  level            Int?              @default(1)
  experience       Int?              @default(0)
  maxHp            Int?              @default(100) @map("max_hp")
  maxMana          Int?              @default(50) @map("max_mana")
  strength         Int?              @default(10)
  dexterity        Int?              @default(10)
  intelligence     Int?              @default(10)
  vitality         Int?              @default(10)
  luck             Int?              @default(5)
  gold             Int?              @default(0)
  createdAt        DateTime?         @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt        DateTime?         @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  accountId        Int?              @map("account_id")
  charName         String?           @map("char_name") @db.VarChar(50)
  damage           Int?              @default(10)
  skin_base        String?           @default("ball_warrior") @db.VarChar(50)
  visualBody       String?           @default("ball_red") @map("visual_body") @db.VarChar(50)
  visualFace       String?           @default("eyes_determined") @map("visual_face") @db.VarChar(50)
  visualHat        String?           @default("hat_mage") @map("visual_hat") @db.VarChar(50)
  faceOffsetX      Int?              @default(0) @map("face_offset_x")
  faceOffsetY      Int?              @default(5) @map("face_offset_y")
  hatOffsetX       Int?              @default(0) @map("hat_offset_x")
  hatOffsetY       Int?              @default(-20) @map("hat_offset_y")
  faceScale        Decimal?          @default(1.0) @map("face_scale") @db.Decimal(4, 2)
  hatScale         Decimal?          @default(1.0) @map("hat_scale") @db.Decimal(4, 2)
  faceRotation     Int?              @default(0) @map("face_rotation")
  hatRotation      Int?              @default(0) @map("hat_rotation")
  faceWidth        Int?              @default(35) @map("face_width")
  faceHeight       Int?              @default(18) @map("face_height")
  hatWidth         Int?              @default(60) @map("hat_width")
  hatHeight        Int?              @default(45) @map("hat_height")
  bodyColor        String?           @default("#FF6B6B") @map("body_color") @db.VarChar(7)
  eyeColor         String?           @default("#FFFFFF") @map("eye_color") @db.VarChar(7)
  account          Account?          @relation(fields: [accountId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  inventory        Inventory?
  items            Item[]
  player_equipment player_equipment?
  player_skills    player_skills[]

  @@index([sessionId], map: "idx_players_session")
  @@map("characters")
}

model Item {
  id                                                   Int                @id @default(autoincrement())
  itemId                                               String             @map("item_id") @db.VarChar(100)
  playerId                                             Int?               @map("player_id")
  inventory_id                                         Int?
  quantity                                             Int?               @default(1)
  slotPosition                                         Int?               @map("slot_position")
  isEquipped                                           Boolean?           @default(false) @map("is_equipped")
  createdAt                                            DateTime?          @default(now()) @map("created_at") @db.Timestamp(6)
  enchant_level                                        Int?               @default(0)
  item_grade                                           String?            @default("C") @db.VarChar(1)
  inventory                                            Inventory?         @relation(fields: [inventory_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  character                                            Character?         @relation(fields: [playerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  player_equipment_player_equipment_amulet_slotToitems player_equipment[] @relation("player_equipment_amulet_slotToitems")
  player_equipment_player_equipment_boots_slotToitems  player_equipment[] @relation("player_equipment_boots_slotToitems")
  player_equipment_player_equipment_chest_slotToitems  player_equipment[] @relation("player_equipment_chest_slotToitems")
  player_equipment_player_equipment_head_slotToitems   player_equipment[] @relation("player_equipment_head_slotToitems")
  player_equipment_player_equipment_legs_slotToitems   player_equipment[] @relation("player_equipment_legs_slotToitems")
  player_equipment_player_equipment_ring1_slotToitems  player_equipment[] @relation("player_equipment_ring1_slotToitems")
  player_equipment_player_equipment_ring2_slotToitems  player_equipment[] @relation("player_equipment_ring2_slotToitems")
  player_equipment_player_equipment_weapon_slotToitems player_equipment[] @relation("player_equipment_weapon_slotToitems")

  @@unique([playerId, itemId, slotPosition], map: "unique_player_item_slot")
  @@index([inventory_id], map: "idx_items_inventory")
  @@index([playerId], map: "idx_items_player")
  @@map("items")
}

model Inventory {
  id         Int        @id @default(autoincrement())
  playerId   Int?       @unique @map("player_id")
  maxSlots   Int?       @default(50) @map("max_slots")
  characters Character? @relation(fields: [playerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  items      Item[]

  @@map("inventory")
}

model ItemTemplate {
  id              String        @id @db.VarChar(50)
  name            String        @db.VarChar(100)
  description     String?
  type            String?       @db.VarChar(20)
  grade           String?       @default("common") @db.VarChar(20)
  price_buy       Int?          @default(0)
  price_sell      Int?          @default(0)
  stackable       Boolean?      @default(true)
  data            Json?
  sprite_offset_y Float?        @default(-20)
  sprite_scale    Float?        @default(1.0)
  equip_slot      String?       @db.VarChar(20)
  item_type       String?       @default("material") @db.VarChar(20)
  is_equipable    Boolean?      @default(false)
  monster_drops   MonsterDrop[]

  @@index([is_equipable, equip_slot], map: "idx_item_templates_equipable")
  @@map("item_templates")
}

model MonsterTemplate {
  id            String        @id @db.VarChar(50)
  name          String        @db.VarChar(100)
  level         Int?          @default(1)
  type          String?       @db.VarChar(20)
  appearance    Json?
  stats         Json?
  behavior      Json?
  rewards       Json?
  monster_drops MonsterDrop[]

  @@map("monster_templates")
}

model MonsterDrop {
  id                Int              @id @default(autoincrement())
  monsterId         String?          @map("monster_id") @db.VarChar(50)
  itemId            String?          @map("item_id") @db.VarChar(50)
  chance            Decimal?         @db.Decimal(5, 4)
  minQuantity       Int?             @default(1) @map("min_quantity")
  maxQuantity       Int?             @default(1) @map("max_quantity")
  item_templates    ItemTemplate?    @relation(fields: [itemId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  monster_templates MonsterTemplate? @relation(fields: [monsterId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([monsterId, itemId], map: "unique_monster_item")
  @@map("monster_drops")
}

model global_visual_settings {
  id         Int       @id @default(autoincrement())
  body_type  String    @db.VarChar(50)
  layer_type String    @db.VarChar(20)
  asset_file String    @db.VarChar(100)
  y_offset   Int?      @default(0)
  x_offset   Int?      @default(0)
  scale      Decimal?  @default(1.0) @db.Decimal(3, 2)
  rotation   Decimal?  @default(0) @db.Decimal(5, 2)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)

  @@unique([body_type, layer_type])
  @@index([body_type], map: "idx_global_visual_body")
}

model inventory_slots {
  player_id    String        @db.VarChar(255)
  item_id      String?       @db.Uuid
  slot_index   Int
  is_equipped  Boolean?      @default(false)
  player_items player_items? @relation(fields: [item_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([player_id, slot_index])
}

model player_equipment {
  id                                        Int        @id @default(autoincrement())
  player_id                                 Int?       @unique
  weapon_slot                               Int?
  head_slot                                 Int?
  chest_slot                                Int?
  legs_slot                                 Int?
  boots_slot                                Int?
  ring1_slot                                Int?
  ring2_slot                                Int?
  amulet_slot                               Int?
  items_player_equipment_amulet_slotToitems Item?      @relation("player_equipment_amulet_slotToitems", fields: [amulet_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  items_player_equipment_boots_slotToitems  Item?      @relation("player_equipment_boots_slotToitems", fields: [boots_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  items_player_equipment_chest_slotToitems  Item?      @relation("player_equipment_chest_slotToitems", fields: [chest_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  items_player_equipment_head_slotToitems   Item?      @relation("player_equipment_head_slotToitems", fields: [head_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  items_player_equipment_legs_slotToitems   Item?      @relation("player_equipment_legs_slotToitems", fields: [legs_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  characters                                Character? @relation(fields: [player_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  items_player_equipment_ring1_slotToitems  Item?      @relation("player_equipment_ring1_slotToitems", fields: [ring1_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  items_player_equipment_ring2_slotToitems  Item?      @relation("player_equipment_ring2_slotToitems", fields: [ring2_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
  items_player_equipment_weapon_slotToitems Item?      @relation("player_equipment_weapon_slotToitems", fields: [weapon_slot], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model player_items {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  player_id         String            @db.VarChar(255)
  template_id       String            @db.VarChar(255)
  enhancement_level Int?              @default(0)
  custom_stats      Json?
  created_at        DateTime?         @default(now()) @db.Timestamp(6)
  inventory_slots   inventory_slots[]
}

model player_skills {
  id          Int        @id @default(autoincrement())
  player_id   Int?
  skill_id    String     @db.VarChar(100)
  skill_level Int?       @default(1)
  characters  Character? @relation(fields: [player_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([player_id, skill_id])
  @@index([player_id], map: "idx_skills_player")
}

model recipe_ingredients {
  id                 Int      @id @default(autoincrement())
  recipe_id          Int?
  ingredient_item_id String   @db.VarChar(100)
  quantity           Int
  recipes            recipes? @relation(fields: [recipe_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model recipes {
  id                 Int                  @id @default(autoincrement())
  result_item_id     String               @db.VarChar(100)
  recipe_item_id     String               @db.VarChar(100)
  min_level          Int?                 @default(1)
  craft_cost_gold    Int?                 @default(0)
  recipe_ingredients recipe_ingredients[]
}
